<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Free Online Bulk Image & PDF Converter | IT Tool</title>
    <meta name="description" content="Convert multiple images to JPG, PNG, WEBP, or a single PDF document for free. Our secure, browser-based bulk tool is fast and requires no uploads.">
    
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-VVGNY8FVJE"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-VVGNY8FVJE');
  </script>
    <style>
        /* Base and Reusable Styles */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body { font-family: 'Roboto', sans-serif; background-color: #0F0F1A; color: #E0E0E0; line-height: 1.6; overflow-x: hidden; }
        h1, h2, h3, h4, h5, h6 { font-family: 'Orbitron', sans-serif; color: #FFF; margin-bottom: 0.75em; }
        a { color: #00f7ff; text-decoration: none; transition: color 0.3s ease; }
        a:hover { color: #ff00c3; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        :root { --neon-blue: #00f7ff; --neon-pink: #ff00c3; --neon-purple: #9d00ff; --neon-green: #00ff84; --dark-bg: #0F0F1A; --card-bg: #1A1A2E; --neon-red: #ff2f00; }
        .neon-text { text-shadow: 0 0 5px var(--neon-blue), 0 0 10px var(--neon-blue), 0 0 15px var(--neon-blue), 0 0 20px var(--neon-pink); }
        .btn { display: inline-block; padding: 10px 24px; border-radius: 50px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; transition: all 0.3s ease; cursor: pointer; border: 2px solid transparent; font-size: 0.85rem; }
        .btn:disabled { cursor: not-allowed; background-color: #555 !important; box-shadow: none !important; color: #999 !important; border-color: #555 !important; transform: none !important; }
        .btn-neon { background-color: var(--neon-blue); color: var(--dark-bg); box-shadow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue); }
        .btn-neon:hover:not(:disabled) { background-color: var(--neon-pink); color: #fff; box-shadow: 0 0 15px var(--neon-pink), 0 0 30px var(--neon-pink), 0 0 5px #fff inset; transform: translateY(-3px); }
        .btn-outline-neon { background-color: transparent; color: var(--neon-blue); border-color: var(--neon-blue); box-shadow: 0 0 8px var(--neon-blue) inset; }
        .btn-outline-neon:hover:not(:disabled) { background-color: var(--neon-blue); color: var(--dark-bg); box-shadow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue); transform: translateY(-3px); }

        /* --- REDESIGNED HEADER --- */
        header { background-color: rgba(15, 15, 26, 0.90); backdrop-filter: blur(10px); padding: 15px 0; position: sticky; top: 0; width: 100%; z-index: 1000; box-shadow: 0 2px 15px rgba(0, 247, 255, 0.1); }
        header .container { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.6rem; font-weight: bold; display: flex; align-items: center; }
        .logo i { margin-right: 10px; font-size: 1.5em; color: var(--neon-blue); }
        .logo span span.neon-pink { text-shadow: 0 0 5px var(--neon-pink), 0 0 10px var(--neon-pink); }
        .tool-nav-icons { display: flex; align-items: center; gap: 25px; }
        .tool-nav-icons a { color: #A0A0A0; font-size: 1.3rem; transition: all 0.3s ease; }
        .tool-nav-icons a:hover, .tool-nav-icons a.active {
            color: var(--neon-blue);
            text-shadow: 0 0 8px var(--neon-blue), 0 0 15px var(--neon-blue);
            transform: translateY(-2px);
        }

        /* --- REDESIGNED FOOTER --- */
        .tool-page-footer { background-color: #0A0A12; padding: 30px 0; margin-top: 50px; border-top: 2px solid var(--neon-purple); box-shadow: 0 -2px 15px rgba(157, 0, 255, 0.15); }
        .tool-page-footer .container { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; }
        .footer-left { display: flex; align-items: center; gap: 25px; }
        .footer-left .logo { font-size: 1.5rem; }
        .footer-right { display: flex; align-items: center; }
        .social-icons a { color: #A0A0A0; font-size: 1.5rem; margin-left: 18px; transition: all 0.3s ease; display: inline-block; }
        .social-icons a:hover { transform: translateY(-3px) scale(1.1); }
        .social-icons a:hover .fa-twitter { color: var(--neon-blue); text-shadow: 0 0 8px var(--neon-blue); }
        .social-icons a:hover .fa-instagram { color: var(--neon-pink); text-shadow: 0 0 8px var(--neon-pink); }
        .social-icons a:hover .fa-youtube { color: #ff2f00; text-shadow: 0 0 8px #ff2f00; }
        .social-icons a:hover .fa-facebook-f { color: #1877F2; text-shadow: 0 0 8px #1877F2; }
        .copyright { width: 100%; text-align: center; padding-top: 25px; margin-top: 20px; border-top: 1px solid rgba(157, 0, 255, 0.2); font-size: 0.8rem; color: #888; }
        
        /* --- Tool Page Specific Styles --- */
        .tool-header { padding: 30px 0; text-align: center; }
        .tool-header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .tool-header .breadcrumb { font-size: 0.9rem; color: #A0A0A0; }
        .tool-header .breadcrumb a { color: var(--neon-blue); }
        .tool-header .breadcrumb .current { color: #E0E0E0; }
        .tool-interface-container { background-color: var(--card-bg); padding: 25px; border-radius: 12px; border: 1px solid var(--neon-purple); box-shadow: 0 0 25px rgba(157, 0, 255, 0.2); }
        .upload-box { border: 3px dashed var(--neon-purple); border-radius: 12px; padding: 40px 20px; text-align: center; cursor: pointer; transition: all 0.3s ease; background-color: #0F0F1A; margin-bottom: 25px; }
        .upload-box:hover, .upload-box.dragover { border-color: var(--neon-pink); background-color: #1A1A2E; }
        .upload-box i { font-size: 3rem; color: var(--neon-blue); margin-bottom: 15px; }
        .upload-box p { font-size: 1.1rem; color: #E0E0E0; margin: 0; }
        .upload-box span { font-size: 0.9rem; color: #A0A0A0; }
        #file-input { display: none; }
        
        /* --- Bulk File List Styles --- */
        #file-list-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; margin-top: 20px; }
        .file-item { background-color: #0F0F1A; border: 1px solid var(--neon-blue); border-radius: 8px; padding: 10px; display: flex; flex-direction: column; position: relative; overflow: hidden; }
        .file-thumbnail { width: 100%; height: 120px; object-fit: cover; border-radius: 4px; margin-bottom: 10px; }
        .file-details { font-size: 0.8rem; color: #A0A0A0; word-break: break-all; }
        .file-name { font-weight: bold; color: #E0E0E0; margin-bottom: 4px; }
        .remove-file-btn { position: absolute; top: 5px; right: 5px; background: rgba(255, 47, 0, 0.7); color: #fff; border: none; border-radius: 50%; width: 22px; height: 22px; cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; }
        .remove-file-btn:hover { background: var(--neon-red); transform: scale(1.1); }
        .file-status { font-weight: bold; margin-top: 8px; text-align: center; font-size: 0.85rem; }
        .file-status.pending { color: var(--neon-blue); }
        .file-status.converting { color: var(--neon-pink); }
        .file-status.done { color: var(--neon-green); }

        .conversion-options { margin-top: 25px; display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 20px; }
        .form-group { display: flex; flex-direction: column; align-items: center; }
        .form-group label { font-size: 1rem; color: #E0E0E0; margin-bottom: 8px; font-weight: bold; }
        .form-group select, .form-group input { background-color: #0F0F1A; border: 1px solid var(--neon-blue); color: #E0E0E0; padding: 8px 12px; border-radius: 25px; font-size: 0.9rem; }
        #quality-value { color: var(--neon-green); font-weight: bold; }
        .tool-controls { text-align: center; margin-top: 25px; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;}
        #status-message { margin-top: 20px; padding: 10px 15px; border-radius: 5px; text-align: center; font-weight: bold; display: none; }
        #status-message.success { background-color: rgba(0, 255, 132, 0.1); color: var(--neon-green); border: 1px solid var(--neon-green); }
        #status-message.error { background-color: rgba(255, 47, 0, 0.1); color: var(--neon-red); border: 1px solid var(--neon-red); }
        
        .content-section { max-width: 900px; margin: 50px auto; color: #C0C0C0; }
        .content-section h2 { font-size: 1.8rem; color: #fff; border-left: 4px solid var(--neon-blue); padding-left: 15px; margin-bottom: 20px; }
        .faq-item { background: var(--card-bg); margin-bottom: 10px; border-radius: 8px; }
        .faq-question { padding: 15px; cursor: pointer; font-weight: bold; font-size: 1.1rem; color: #fff; position: relative; }
        .faq-question::after { content: '\f078'; font-family: "Font Awesome 6 Free"; font-weight: 900; position: absolute; right: 20px; transition: transform 0.3s ease; }
        .faq-item.active .faq-question::after { transform: rotate(180deg); }
        .faq-answer { max-height: 0; overflow: hidden; padding: 0 15px; transition: max-height 0.4s ease, padding 0.4s ease; }
        
        /* --- Mobile Responsive Styles --- */
        @media (max-width: 991px) { .tool-nav-icons { gap: 20px; } .tool-nav-icons a { font-size: 1.2rem; } #file-list-container { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); } }
        @media (max-width: 767px) { .tool-nav-icons a:not(:first-child):not(.active) { display: none; } .tool-page-footer .container { flex-direction: column; text-align: center; } .footer-left { flex-direction: column; gap: 20px; } .footer-right { margin-top: 10px; } .social-icons a { margin: 0 10px; } #file-list-container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <!-- ======== HEADER ======== -->
    <header>
        <div class="container">
            <a href="index.html" class="logo">
                <i class="fas fa-cubes-stacked"></i>
                <span>IT<span class="neon-pink">Tools</span></span>
            </a>
            <div class="tool-nav-icons">
                <a href="index.html" title="Home"><i class="fas fa-home"></i></a>
                <a href="index.html#image-tools-section" title="Image Tools" class="active"><i class="fas fa-image"></i></a>
                <a href="index.html#pdf-tools-section" title="PDF & Document Tools"><i class="fas fa-file-pdf"></i></a>
                <a href="index.html#calculator-tools-section" title="Calculator Tools"><i class="fas fa-calculator"></i></a>
                <a href="index.html#text-tools-section" title="Text Tools"><i class="fas fa-font"></i></a>
                <a href="index.html#developer-tools-section" title="Developer Tools"><i class="fas fa-code"></i></a>
                <a href="index.html#color-tools-section" title="Color Tools"><i class="fas fa-palette"></i></a>
                <a href="index.html#seo-tools-section" title="SEO Tools"><i class="fas fa-search-dollar"></i></a>
                <a href="index.html#utility-tools-section" title="Utility Tools"><i class="fas fa-wrench"></i></a>
            </div>
        </div> 
    </header>

    <main>
        <section class="tool-header">
            <div class="container">
                <nav class="breadcrumb" aria-label="breadcrumb">
                    <a href="index.html">Home</a> &gt; <a href="index.html#image-tools-section">Image Tools</a> &gt; <span class="current">Bulk Image & PDF Converter</span>
                </nav>
                <h1><span class="neon-text">Bulk Image & PDF</span> Converter</h1>
                <p class="subtitle">Convert multiple images to JPG, PNG, WEBP, or merge them into a single PDF.</p>
            </div>
        </section>

        <div class="container">
            <div class="tool-interface-container">
                <input type="file" id="file-input" accept="image/*" multiple>
                
                <div id="upload-box" class="upload-box">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p><strong>Drag & Drop</strong> your images here</p>
                    <span>or click to select files</span>
                </div>

                <div id="file-list-container"></div>
                
                <div id="options-container" style="display: none;">
                    <div class="conversion-options">
                        <div class="form-group">
                            <label for="format-select">Convert all to:</label>
                            <select id="format-select">
                                <option value="pdf">PDF (Single File)</option>
                                <option value="png">PNG</option>
                                <option value="jpeg">JPG</option>
                                <option value="webp">WEBP</option>
                                <option value="gif">GIF</option>
                                <option value="bmp">BMP</option>
                            </select>
                        </div>
                        <div id="quality-container" class="form-group" style="display: none;">
                            <label for="quality-slider">Quality: <span id="quality-value">0.9</span></label>
                            <input type="range" id="quality-slider" min="0.1" max="1" step="0.05" value="0.9">
                        </div>
                    </div>
                </div>
                
                <div id="status-message"></div>

                <div class="tool-controls">
                    <button id="convert-btn" class="btn btn-neon" disabled><i class="fas fa-sync-alt"></i> Convert Now</button>
                    <button id="download-btn" class="btn btn-neon" style="display: none;"><i class="fas fa-download"></i> Download</button>
                    <button id="reset-btn" class="btn btn-outline-neon" style="display: none;"><i class="fas fa-eraser"></i> Clear Queue</button>
                </div>
            </div>
        </div>

        <section class="neon-section">
            <div class="container">
                <div class="content-section">
                    <h2>How to Use the Bulk Converter</h2>
                    <ol style="padding-left: 20px; line-height: 1.8;">
                        <li><strong>Upload Your Images:</strong> Drag and drop multiple image files or click the upload box to select them.</li>
                        <li><strong>Choose an Output Format:</strong> Select your desired format. Choose an image type (like PNG or JPG) to get a ZIP file, or select "PDF" to merge all images into one document.</li>
                        <li><strong>Click "Convert Now":</strong> The tool will process each image instantly in your browser. Watch the status update on each file.</li>
                        <li><strong>Download Your File(s):</strong> After conversion, a download button will appear. Click it to save your new ZIP archive or single PDF document.</li>
                        <li><strong>Start Over:</strong> Click "Clear Queue" to reset the tool and upload a new batch of images.</li>
                    </ol>
                </div>
                 <div class="content-section">
                    <h2>Frequently Asked Questions (FAQ)</h2>
                    <div class="faq-list">
                        <div class="faq-item">
                            <h3 class="faq-question">How does the PDF conversion work?</h3>
                            <div class="faq-answer"><p>When you select "PDF" as the output, the tool takes all the images you uploaded and merges them into a single, multi-page PDF document. Each image will be placed on its own page, preserving its original dimensions.</p></div>
                        </div>
                        <div class="faq-item">
                            <h3 class="faq-question">Are my images uploaded to a server?</h3>
                            <div class="faq-answer"><p>No, absolutely not. Our Converter is a browser-based tool. Your files never leave your computer, ensuring 100% privacy and security for single or bulk conversions.</p></div>
                        </div>
                        <div class="faq-item">
                            <h3 class="faq-question">How does the quality setting work?</h3>
                            <div class="faq-answer"><p>The quality slider appears for "lossy" formats like JPG and WEBP. A value of '1' is the highest quality (and largest file size), while lower values create smaller files at the cost of some image detail. This option is hidden for formats like PNG and PDF where it does not apply.</p></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- ======== FOOTER ======== -->
    <footer class="tool-page-footer">
        <div class="container">
            <div class="footer-left">
                <a href="index.html" class="logo">
                    <i class="fas fa-cubes-stacked"></i>
                </a>
                <a href="index.html" class="btn btn-outline-neon"><i class="fas fa-th-large"></i> Back to All Tools</a>
            </div>
            <div class="footer-right">
                <div class="social-icons">
                    <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" aria-label="Youtube"><i class="fab fa-youtube"></i></a>
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                </div>
            </div>
        </div>
        <div class="copyright">
            <p>© 2025 ITTool. All rights reserved.</p>
        </div>
    </footer>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        // --- FAQ Accordion Logic ---
        document.querySelectorAll('.faq-question').forEach(button => {
            button.addEventListener('click', () => {
                const faqItem = button.parentElement;
                faqItem.classList.toggle('active');
                const answer = button.nextElementSibling;
                if (faqItem.classList.contains('active')) {
                    answer.style.maxHeight = answer.scrollHeight + "px";
                    answer.style.padding = "15px";
                } else {
                    answer.style.maxHeight = "0";
                    answer.style.padding = "0 15px";
                }
            });
        });

        // --- Core Bulk Image & PDF Converter Logic ---
        const uploadBox = document.getElementById('upload-box');
        const fileInput = document.getElementById('file-input');
        const fileListContainer = document.getElementById('file-list-container');
        const optionsContainer = document.getElementById('options-container');
        const formatSelect = document.getElementById('format-select');
        const qualityContainer = document.getElementById('quality-container');
        const qualitySlider = document.getElementById('quality-slider');
        const qualityValue = document.getElementById('quality-value');
        const convertBtn = document.getElementById('convert-btn');
        const downloadBtn = document.getElementById('download-btn');
        const resetBtn = document.getElementById('reset-btn');
        const statusMessage = document.getElementById('status-message');
        
        let fileQueue = [];
        let fileCounter = 0;
        let generatedPdf = null;

        // --- Event Listeners ---
        uploadBox.addEventListener('click', () => fileInput.click());
        uploadBox.addEventListener('dragover', (e) => { e.preventDefault(); uploadBox.classList.add('dragover'); });
        uploadBox.addEventListener('dragleave', () => { uploadBox.classList.remove('dragover'); });
        uploadBox.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadBox.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });
        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));
        formatSelect.addEventListener('change', () => {
            const selectedFormat = formatSelect.value;
            const showQuality = (selectedFormat === 'jpeg' || selectedFormat === 'webp');
            qualityContainer.style.display = showQuality ? 'flex' : 'none';
            updateButtonText();
        });
        qualitySlider.addEventListener('input', () => { qualityValue.textContent = qualitySlider.value; });
        convertBtn.addEventListener('click', () => {
            if (formatSelect.value === 'pdf') {
                processPdfConversion();
            } else {
                processImageConversionQueue();
            }
        });
        downloadBtn.addEventListener('click', initiateDownload);
        resetBtn.addEventListener('click', resetUI);

        // --- UI State & Text Management ---
        function updateUIState() {
            const hasFiles = fileQueue.length > 0;
            const isConverted = hasFiles && fileQueue.every(f => f.status === 'done' || f.status === 'error');
            
            optionsContainer.style.display = hasFiles ? 'block' : 'none';
            uploadBox.style.display = hasFiles ? 'none' : 'block';
            resetBtn.style.display = hasFiles ? 'inline-block' : 'none';

            convertBtn.disabled = !hasFiles || isConverted;
            convertBtn.style.display = isConverted ? 'none' : 'inline-block';
            
            const canDownload = isConverted && (generatedPdf !== null || formatSelect.value !== 'pdf');
            downloadBtn.style.display = canDownload ? 'inline-block' : 'none';

            if (!hasFiles) statusMessage.style.display = 'none';
        }

        function updateButtonText() {
            const format = formatSelect.value;
            if (format === 'pdf') {
                convertBtn.innerHTML = `<i class="fas fa-file-pdf"></i> Create PDF`;
                downloadBtn.innerHTML = `<i class="fas fa-file-pdf"></i> Download PDF`;
            } else {
                convertBtn.innerHTML = `<i class="fas fa-sync-alt"></i> Convert Files`;
                downloadBtn.innerHTML = `<i class="fas fa-file-archive"></i> Download All (ZIP)`;
            }
        }

        // --- File Handling ---
        function handleFiles(files) {
            let validFiles = Array.from(files).filter(file => {
                if (!file.type.startsWith('image/')) {
                    showStatus(`Skipped non-image file: ${file.name}`, 'error');
                    return false;
                }
                return true;
            });

            if(validFiles.length === 0) return;

            validFiles.forEach(file => {
                const fileId = `file-${fileCounter++}`;
                const reader = new FileReader();
                reader.onload = (e) => {
                    const fileObject = { id: fileId, file: file, previewSrc: e.target.result, status: 'pending', convertedDataUrl: null, convertedFileName: null };
                    fileQueue.push(fileObject);
                    renderFileList();
                };
                reader.readAsDataURL(file);
            });
            showStatus(`${validFiles.length} image(s) loaded. Ready to convert.`, 'success');
        }

        function removeFile(fileId) {
            fileQueue = fileQueue.filter(f => f.id !== fileId);
            renderFileList();
        }

        function renderFileList() {
            fileListContainer.innerHTML = '';
            fileQueue.forEach(fileObj => {
                const item = document.createElement('div');
                item.className = 'file-item';
                item.id = fileObj.id;
                let statusClass = fileObj.status;
                let statusIcon = fileObj.status === 'pending' ? 'fa-clock' : fileObj.status === 'converting' ? 'fa-sync-alt fa-spin' : 'fa-check-circle';
                item.innerHTML = `
                    <button class="remove-file-btn" onclick="removeFile('${fileObj.id}')" title="Remove File">&times;</button>
                    <img src="${fileObj.previewSrc}" class="file-thumbnail" alt="${fileObj.file.name}">
                    <div class="file-details"><div class="file-name">${fileObj.file.name}</div><div>(${(fileObj.file.size / 1024).toFixed(1)} KB)</div></div>
                    <div class="file-status ${statusClass}"><i class="fas ${statusIcon}"></i> ${fileObj.status.charAt(0).toUpperCase() + fileObj.status.slice(1)}</div>`;
                fileListContainer.appendChild(item);
            });
            updateUIState();
        }

        // --- Conversion Logic ---
        async function processImageConversionQueue() {
            convertBtn.disabled = true;
            resetBtn.disabled = true;
            showStatus('Conversion in progress...', 'success');
            const conversionPromises = fileQueue.map(f => (f.status === 'pending' ? convertSingleImage(f) : Promise.resolve(f)));
            await Promise.all(conversionPromises);
            resetBtn.disabled = false;
            showStatus('All files converted successfully!', 'success');
            renderFileList();
        }

        function convertSingleImage(fileObj) {
            fileObj.status = 'converting';
            renderFileList();
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width; canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    const selectedFormat = formatSelect.value;
                    const mimeType = `image/${selectedFormat}`;
                    if (mimeType === 'image/jpeg' || mimeType === 'image/bmp') {
                        ctx.fillStyle = '#FFFFFF'; ctx.fillRect(0, 0, canvas.width, canvas.height);
                    }
                    ctx.drawImage(img, 0, 0);
                    fileObj.convertedDataUrl = canvas.toDataURL(mimeType, parseFloat(qualitySlider.value));
                    const originalName = fileObj.file.name.substring(0, fileObj.file.name.lastIndexOf('.'));
                    fileObj.convertedFileName = `${originalName}.${selectedFormat}`;
                    fileObj.status = 'done';
                    resolve(fileObj);
                };
                img.onerror = () => { fileObj.status = 'error'; resolve(fileObj); };
                img.src = fileObj.previewSrc;
            });
        }
        
        async function processPdfConversion() {
            if (!window.jspdf) { showStatus('Error: PDF library not loaded.', 'error'); return; }
            convertBtn.disabled = true; resetBtn.disabled = true;
            showStatus('Creating PDF document...', 'success');
            
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            pdf.deletePage(1); // Start with a clean document

            for (const fileObj of fileQueue) {
                fileObj.status = 'converting';
                renderFileList();
                try {
                    const img = await loadImage(fileObj.previewSrc);
                    const imgWidth = img.width;
                    const imgHeight = img.height;
                    const orientation = imgWidth > imgHeight ? 'l' : 'p';
                    
                    pdf.addPage([imgWidth, imgHeight], orientation);
                    pdf.addImage(img, 'JPEG', 0, 0, imgWidth, imgHeight); // jsPDF handles various image data well, JPEG is robust
                    
                    fileObj.status = 'done';
                } catch (e) {
                    fileObj.status = 'error';
                }
                renderFileList();
            }
            generatedPdf = pdf;
            resetBtn.disabled = false;
            showStatus('PDF created successfully!', 'success');
            updateUIState();
        }

        function loadImage(src) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.onerror = (err) => reject(err);
                img.src = src;
            });
        }
        
        // --- Download and Reset ---
        function initiateDownload() {
            if (formatSelect.value === 'pdf' && generatedPdf) {
                generatedPdf.save('ToolCraftPro_Converted.pdf');
            } else {
                downloadAllAsZip();
            }
        }
        
        function downloadAllAsZip() {
            if (!window.JSZip) { showStatus('Error: Zipping library not loaded.', 'error'); return; }
            const zip = new JSZip();
            let fileCount = 0;
            fileQueue.forEach(f => {
                if (f.status === 'done' && f.convertedDataUrl) {
                    zip.file(f.convertedFileName, f.convertedDataUrl.split(',')[1], { base64: true });
                    fileCount++;
                }
            });
            if (fileCount > 0) {
                zip.generateAsync({ type: "blob" }).then(content => {
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(content);
                    link.download = "ToolCraftPro_Converted_Images.zip";
                    document.body.appendChild(link); link.click(); document.body.removeChild(link);
                });
            } else { showStatus('No converted files to download.', 'error'); }
        }

        function resetUI() {
            fileQueue = []; fileCounter = 0; generatedPdf = null;
            fileInput.value = '';
            fileListContainer.innerHTML = '';
            showStatus('Queue cleared. Ready for new files.', 'success');
            setTimeout(() => statusMessage.style.display = 'none', 3000);
            updateUIState();
        }
        
        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = type;
            statusMessage.style.display = 'block';
        }

        // Initial UI state
        updateUIState();
        updateButtonText();
        formatSelect.dispatchEvent(new Event('change'));
    </script>
</body>
</html>
